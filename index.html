<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle"></title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 950px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }
        h1 { font-size: 2.2em; }
        h2 { font-size: 1.8em; }
        h3 { font-size: 1.4em; text-align: left; margin-top: 25px; }

        .language-selector {
            text-align: right;
            margin-bottom: 20px;
        }
        .language-selector label {
            margin-right: 10px;
            font-weight: bold;
        }
        .language-selector select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
        }

        .section-box {
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.07);
            background-color: #fdfefe;
        }

        .disclaimer {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }
        .info-section {
            background-color: #e0f7fa;
            border: 1px solid #00bcd4;
            color: #006064;
        }
        .video-section {
            background-color: #f0f8ff;
            border: 1px solid #a7d9f7;
        }
        .question-section {
            background-color: #e6f7ff;
            border: 1px solid #99daff;
            text-align: center;
            padding: 25px;
            margin-top: 25px;
            border-radius: 8px;
        }
        .final-consent-section {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
            text-align: center;
        }
        
        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            border-radius: 8px;
            background-color: #000; /* Default background */
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        /* --- CRITICAL CSS for hiding YouTube end screen and UI --- */
        .video-wrapper.hide-yt-ui .ytp-chrome-bottom,
        .video-wrapper.hide-yt-ui .ytp-endscreen,
        .video-wrapper.hide-yt-ui .ytp-suggestions,
        .video-wrapper.hide-yt-ui .ytp-large-play-button,
        .video-wrapper.hide-yt-ui .ytp-gradient-bottom,
        .video-wrapper.hide-yt-ui .ytp-gradient-top,
        .video-wrapper.hide-yt-ui .ytp-contextmenu,
        .video-wrapper.hide-yt-ui .ytp-progress-bar-container,
        .video-wrapper.hide-yt-ui .ytp-button,
        .video-wrapper.hide-yt-ui .ytp-watermark,
        .video-wrapper.hide-yt-ui .ytp-title-channel-logo,
        .video-wrapper.hide-yt-ui .ytp-playlist-menu-button,
        .video-wrapper.hide-yt-ui .ytp-ce-video, /* Related video thumbnails */
        .video-wrapper.hide-yt-ui .ytp-ce-channel, /* Channel link */
        .video-wrapper.hide-yt-ui .ytp-ce-element, /* Generic end screen element */
        .video-wrapper.hide-yt-ui .ytp-next-button, /* Next video button */
        .video-wrapper.hide-yt-ui .ytp-hotkey-layer, /* Hotkey overlay */
        .video-wrapper.hide-yt-ui .ytp-title-link { /* Title link in top bar */
            display: none !important;
            visibility: hidden !important; /* Extra strong hiding */
            pointer-events: none !important; /* Ensure no interaction */
        }
        .video-wrapper.hide-yt-ui iframe {
            visibility: hidden !important;
        }
        .video-wrapper.hide-yt-ui {
            background-color: black !important;
        }
        /* --- END CRITICAL CSS --- */

        p {
            margin-bottom: 15px;
            font-size: 1.05em;
        }
        ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0;
            margin-bottom: 15px;
        }
        li {
            margin-bottom: 8px;
        }

        .button-group {
            margin-top: 25px;
        }
        .button-group button, #startProcessButton, #submitConsentButton, #downloadTranscriptBtn {
            background-color: #28a745; /* Green for positive actions */
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 10px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .button-group button.no-btn {
            background-color: #dc3545; /* Red for negative/re-watch */
        }
        #submitConsentButton {
            background-color: #007bff; /* Blue for final consent */
        }
        #downloadTranscriptBtn {
            background-color: #6c757d; /* Gray for download */
        }
        .button-group button:hover, #startProcessButton:hover, #submitConsentButton:hover, #downloadTranscriptBtn:hover {
            opacity: 0.95;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        .button-group button:active, #startProcessButton:active, #submitConsentButton:active, #downloadTranscriptBtn:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #submitConsentButton:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }
        .hidden {
            display: none;
        }
        .form-group {
            margin-bottom: 15px;
            text-align: left;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: calc(100% - 22px); /* Adjust for padding and border */
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        #consentCheckboxLabel {
            display: block;
            margin: 25px auto;
            font-size: 1.15em;
            max-width: 80%;
            text-align: left;
            cursor: pointer;
        }
        #consentCheckbox {
            margin-right: 12px;
            transform: scale(1.3);
            vertical-align: middle;
        }
        #thankYouMessage {
            color: #28a745;
            font-weight: bold;
            font-size: 1.4em;
            margin-top: 30px;
            text-align: center;
        }
        .important-note {
            background-color: #ffe0b2;
            border: 1px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin-top: 25px;
            font-weight: bold;
            color: #e65100;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="language-selector">
            <label for="languageSelect" id="selectLanguageLabel"></label>
            <select id="languageSelect">
                <option value="en">English</option>
                <option value="hi">हिन्दी (Hindi)</option>
            </select>
        </div>

        <h1 id="mainHeading">
            <span id="departmentName"></span><br><span id="hospitalName"></span>
        </h1>
        <h2 id="consentProcessTitle"></h2>

        <div id="introSection" class="section-box disclaimer">
            <p id="disclaimerP1"></p>
            <p id="disclaimerP2"></p>
            <div style="text-align: center; margin-top: 30px;">
                <button id="startProcessButton"></button>
            </div>
        </div>

        <div id="textSection1" class="hidden section-box info-section">
            <h2 id="video1TextSectionTitle"></h2>
            <p id="video1TextSectionP1"></p>
            <p id="video1TextSectionP2"></p>
            <div id="video1TextSectionP3"></div>
            <div class="question-section" id="questionText1">
                <p id="questionText1Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="video1Section" id="btn1Proceed"></button>
                    <button class="no-btn" data-action="rewatch-text" data-target="textSection1" id="btn1Review"></button>
                </div>
            </div>
        </div>

        <div id="video1Section" class="hidden section-box video-section">
            <h2 id="video1Title"></h2>
            <p id="video1Intro"></p>
            <div class="video-wrapper" id="videoWrapper1">
                <div id="videoPlayer1"></div> 
            </div>
            <p id="videoMessage1" class="hidden" style="text-align: center; margin-top: 15px; font-style: italic; color: #555; font-size: 0.95em;"></p>
            
            <div class="question-section hidden" id="questionVideo1">
                <p id="questionVideo1Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="textSection2" id="btn1VideoProceed"></button>
                    <button class="no-btn" data-action="rewatch-video" data-player-id="player1" data-section="video1Section" id="btn1WatchAgain"></button>
                </div>
            </div>
        </div>

        <div id="textSection2" class="hidden section-box info-section">
            <h2 id="video2TextSectionTitle"></h2>
            <p id="video2TextSectionP1"></p>
            <p id="video2TextSectionP2"></p>
            <div id="video2TextSectionP3"></div>
            <div class="question-section" id="questionText2">
                <p id="questionText2Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="video2Section" id="btn2Proceed"></button>
                    <button class="no-btn" data-action="rewatch-text" data-target="textSection2" id="btn2Review"></button>
                </div>
            </div>
        </div>

        <div id="video2Section" class="hidden section-box video-section">
            <h2 id="video2Title"></h2>
            <p id="video2Intro"></p>
            <div class="video-wrapper" id="videoWrapper2">
                <div id="videoPlayer2"></div>
            </div>
            <p id="videoMessage2" class="hidden" style="text-align: center; margin-top: 15px; font-style: italic; color: #555; font-size: 0.95em;"></p>
            
            <div class="question-section hidden" id="questionVideo2">
                <p id="questionVideo2Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="textSection3" id="btn2VideoProceed"></button>
                    <button class="no-btn" data-action="rewatch-video" data-player-id="player2" data-section="video2Section" id="btn2WatchAgain"></button>
                </div>
            </div>
        </div>

        <div id="textSection3" class="hidden section-box info-section">
            <h2 id="video3TextSectionTitle"></h2>
            <p id="video3TextSectionP1"></p>
            <p id="video3TextSectionP2"></p>
            <div id="video3TextSectionP3"></div>
            <div class="question-section" id="questionText3">
                <p id="questionText3Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="video3Section" id="btn3Proceed"></button>
                    <button class="no-btn" data-action="rewatch-text" data-target="textSection3" id="btn3Review"></button>
                </div>
            </div>
        </div>

        <div id="video3Section" class="hidden section-box video-section">
            <h2 id="video3Title"></h2>
            <p id="video3Intro"></p>
            <div class="video-wrapper" id="videoWrapper3">
                <div id="videoPlayer3"></div>
            </div>
            <p id="videoMessage3" class="hidden" style="text-align: center; margin-top: 15px; font-style: italic; color: #555; font-size: 0.95em;"></p>

            <div class="question-section hidden" id="questionVideo3">
                <p id="questionVideo3Q"></p>
                <div class="button-group">
                    <button class="yes-btn" data-target="finalConsentSection" id="btn3VideoProceed"></button>
                    <button class="no-btn" data-action="rewatch-video" data-player-id="player3" data-section="video3Section" id="btn3WatchAgain"></button>
                </div>
            </div>
        </div>

        <div id="finalConsentSection" class="hidden section-box final-consent-section">
            <h2 id="finalConsentStatementTitle"></h2>
            <p id="finalConsentP1"></p>
            <p id="finalConsentP2"></p>
            <ul style="text-align: left; max-width: 85%; margin: 20px auto;">
                <li id="finalConsentItem1"></li>
                <li id="finalConsentItem2"></li>
                <li id="finalConsentItem3"></li>
                <li id="finalConsentItem4"></li>
                <li id="finalConsentItem5"></li>
                <li id="finalConsentItem6"></li>
                <li id="finalConsentItem7"></li>
                <li id="finalConsentItem8"></li>
                <li id="finalConsentItem9"></li>
                <li id="finalConsentItem10"></li>
                <li id="finalConsentItem11"></li>
                <li id="finalConsentItem12"></li>
                <li id="finalConsentItem13"></li>
                <li id="finalConsentItem14"></li>
            </ul>

            <h3 id="yourDetailsHeading"></h3>
            <div class="form-group">
                <label for="patientName" id="nameLabel"></label>
                <input type="text" id="patientName" required>
            </div>
            <div class="form-group">
                <label for="patientAge" id="ageLabel"></label>
                <input type="number" id="patientAge" required>
            </div>
            <div class="form-group">
                <label for="hospitalId" id="hospitalIdLabel"></label>
                <input type="text" id="hospitalId" required>
            </div>

            <button id="downloadTranscriptBtn"></button>

            <label id="consentCheckboxLabel">
                <input type="checkbox" id="consentCheckbox">
                <span id="consentCheckboxText"></span>
            </label>
            <button id="submitConsentButton" disabled></button>
            <p id="thankYouMessage" class="hidden"></p>

            <div class="important-note">
                <strong id="noteStrong"></strong>
                <span id="noteText"></span>
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // --- LANGUAGE LOCALIZATION CONTENT ---
        const localizedContent = {
            en: {
                pageTitle: "Detailed Kidney Biopsy Consent - Command Hospital (SC) Pune",
                selectLanguageLabel: "Select Language:",
                departmentName: "DEPARTMENT OF NEPHROLOGY",
                hospitalName: "COMMAND HOSPITAL (SC) PUNE",
                consentProcessTitle: "Ultrasound-Guided Kidney Biopsy Consent Process",
                disclaimerP1: "Welcome to this Video-Assisted Kidney Biopsy Consent Page. This interactive tool, provided by the Department of Nephrology, Command Hospital (SC) Pune, offers comprehensive visual and textual information regarding the Ultrasound-Guided Kidney Biopsy procedure. Its purpose is to help you understand the process fully before you provide your formal consent.",
                disclaimerP2: "This tool is for informational purposes only and does not replace a direct, in-person consultation with your healthcare provider. You will have a dedicated opportunity to discuss any questions or concerns with your doctor before the biopsy. Always consult with a qualified medical professional for diagnosis, treatment, and medical advice specific to your condition. Your physical signature on the official consent form will be required before the procedure.",
                startButton: "Start Consent Process",
                
                video1TextSectionTitle: "Part 1: Introduction to Kidney Biopsy",
                video1TextSectionP1: "This introductory section is designed to provide you with a clear understanding of the fundamental aspects of a Kidney Biopsy.",
                video1TextSectionP2: "By going through this part, you will learn about the key narratives essential for grasping what the procedure involves, why it's recommended, and what you need to do to prepare.",
                video1TextSectionP3: "<ul><li><strong>What is a Kidney Biopsy?</strong> A medical procedure where a small sample of kidney tissue is removed for examination under a microscope, performed to diagnose kidney diseases, assess damage, or monitor the effectiveness of treatments.</li><li><strong>Why is it Required?</strong> This procedure is likely to help the treating doctors in arriving at a precise diagnosis, which may also help in planning and deciding the future course and optimal treatment for your ailment.</li><li><strong>Your Preparation for Kidney Biopsy:</strong> Important steps and instructions you need to follow before undergoing the biopsy.</li><li><strong>Risks of not having this procedure:</strong> Not undergoing the procedure might delay or prevent an accurate diagnosis, potentially impacting your treatment plan and prognosis.</li></ul>",
                questionText1Q: "Do you understand the basic definition, necessity, and preparatory steps for an Ultrasound-Guided Kidney Biopsy?",
                proceedButton: "Proceed",
                reviewButton: "Review this section", 
                video1Title: "Video 1: Introduction to Kidney Biopsy",
                video1Intro: "This video will further explain what a kidney biopsy is, why it's required, and essential preparation steps.",
                watchVideoMessage: "Please watch the video to proceed. The question will appear below when the video ends.",
                transcriptTitle: "Video Transcript:",
                questionVideo1Q: "Have you understood the information in this video? If yes, proceed to the next section. If not, watch the video again.",
                watchAgainButton: "Watch the video again", 
                
                video2TextSectionTitle: "Part 2: Kidney Biopsy Procedure Details",
                video2TextSectionP1: "This section will guide you through the intricate details of the Ultrasound-Guided Kidney Biopsy procedure itself.",
                video2TextSectionP2: "It covers the exact steps taken during the biopsy and what immediate care and monitoring you can expect right after the procedure is completed.",
                video2TextSectionP3: "<ul><li><strong>Exact Kidney Biopsy Procedure:</strong> A visual, step-by-step explanation of how the biopsy is performed using real-time ultrasound imaging to ensure precise placement of the biopsy needle. During the procedure, you will typically lie on your stomach. The specific area over your kidney will be numbed using a local anaesthetic. The doctor will use the ultrasound to visualize your kidney and accurately guide a thin biopsy needle to take one or more small tissue samples. You may be asked to hold your breath for a few seconds during needle insertion to minimize kidney movement.</li><li><strong>Sedation/Anaesthesia Technique:</strong> The procedure will be performed under Local Anaesthesia, which numbs the biopsy site. Additionally, sedation may be administered if deemed necessary to help you relax during the procedure.</li><li><strong>Immediate Post-Biopsy Monitoring:</strong> What transpires immediately after the biopsy, including observation and initial care.</li></ul>",
                questionText2Q: "Are you clear about the exact procedure of the Kidney Biopsy and the immediate post-biopsy monitoring steps?",
                video2Title: "Video 2: Kidney Biopsy Procedure",
                video2Intro: "This video will demonstrate the precise kidney biopsy procedure and what happens immediately after.",
                questionVideo2Q: "Have you understood the procedure details? If yes, proceed to the next section. If not, watch the video again.",

                video3TextSectionTitle: "Part 3: Post-Biopsy Instructions and Risks",
                video3TextSectionP1: "This crucial section provides comprehensive information on your care after the kidney biopsy, including important instructions and potential risks.",
                video3TextSectionP2: "It aims to ensure you are fully informed about how to manage your recovery and what to watch out for.",
                video3TextSectionP3: "<ul><li><strong>Post-Biopsy Instructions:</strong> Detailed guidelines for your recovery period, including activity restrictions and medication advice. Post-procedure, there may be a need for you to be detained in the Intensive Care Unit (ICU) for observation and further management.</li><li><strong>Warning Signs:</strong> Critical symptoms or changes that require immediate medical attention.</li><li><strong>Risks of Undergoing a Kidney Biopsy:</strong> There are risks and complications with this procedure. While utmost care will be taken to prevent these complications, they include but are not limited to the following:<ul><li>Some pain and discomfort may occur during and for a few days after the procedure.</li><li>Approximately a 10-15% chance of encountering complications.</li><li>Arterial puncture.</li><li>Passage of blood in urine or collection of blood around the kidney can occur. It is likely to stop spontaneously within a few days of the procedure, but there is about a 0.5% chance that it may persist longer and may require blood transfusion, catheter embolization/coiling or surgery. Bleeding is more common if you have been taking blood thinning drugs such as Warfarin, Aspirin or Clopidogrel.</li><li><strong>Delayed complications:</strong><ul><li>Infection can occur requiring antibiotics and further treatment.</li><li>Formation of arteriovenous fistulas (abnormal connection between an artery and a vein).</li><li>Paralytic ileus (temporary cessation of bowel movements).</li><li>Injury to internal organs in the abdomen and/or chest.</li><li>There is also a minimal risk of death occurring due to this procedure.</li></ul></li></ul></li></ul>",
                questionText3Q: "Do you understand the post-biopsy instructions, warning signs, and the potential risks involved with the Kidney Biopsy?",
                video3Title: "Video 3: Post-Biopsy Instructions and Risks",
                video3Intro: "This video will explain post-biopsy instructions, warning signs, and the risks of undergoing a kidney biopsy.",
                questionVideo3Q: "Have you understood the post-biopsy care and risks? If yes, proceed to the final consent. If not, watch the video again.",

                finalConsentStatementTitle: "Final Consent Statement",
                finalConsentP1: "You have now completed the comprehensive video-assisted informational process for the Ultrasound-Guided Kidney Biopsy at Command Hospital (SC) Pune.",
                finalConsentP2: "By proceeding, you acknowledge that the doctor has explained:",
                finalConsentItem1: "My medical condition and the proposed procedure (taking a tissue from my kidney through a biopsy gun under real time ultrasound guidance), including additional treatment if the doctor finds something unexpected. I understand the risks, including the risks that are specific to me.",
                finalConsentItem2: "Other relevant procedure/treatment options and their associated risks.",
                finalConsentItem3: "My prognosis and the risks of not having the procedure.",
                finalConsentItem4: "No guarantee has been made that the procedure will improve my condition even though it has been carried out with due professional care.",
                finalConsentItem5: "The procedure may include a blood transfusion.",
                finalConsentItem6: "Post procedure there may be a need for me to be detained in the ICU for observation and further management.",
                finalConsentItem7: "Tissues and blood may be removed and could be used for diagnosis or management of my condition, stored and disposed of sensitively by the hospital.",
                finalConsentItem8: "If immediate life-threatening events occur during the procedure, appropriate resuscitative methods would be instituted based on laid out protocols of the hospital.",
                finalConsentItem9: "A doctor other than the Consultant may conduct the procedure. I understand this could be a doctor undergoing further training.",
                finalConsentItem10: "I was able to ask questions and raise concerns with the doctor about my condition, the proposed procedure and its risks, and my treatment options. My questions and concerns have been discussed in the language I understand and answered to my satisfaction.",
                finalConsentItem11: "I understand I have the right to change my mind at any time, including after I have signed this form but, preferably following a discussion with my doctor.",
                finalConsentItem12: "I understand that image(s) or video footage may be recorded as part of and during my procedure and that these image(s) or video(s) will assist the doctor to provide appropriate treatment.",
                finalConsentItem13: "I understand that the benefits of undergoing procedure outweigh the risks and that utmost care will be taken to prevent the above-mentioned complications.",
                finalConsentItem14: "On the basis of the above statements, I request to have the procedure.",
                yourDetailsHeading: "Your Details for Electronic Endorsement",
                nameLabel: "Full Name:",
                ageLabel: "Age:",
                hospitalIdLabel: "Hospital ID Number:",
                downloadTranscriptButton: "Download Full Transcript",
                consentCheckboxText: "I acknowledge the above statements and confirm my request to have the Ultrasound-Guided Kidney Biopsy procedure.",
                consentBiopsyButton: "I Consent to Biopsy",
                thankYouMessage: "Thank you for completing the informational process. Please inform your healthcare provider of your decision. A physical consent form will be provided for your signature.",
                noteStrong: "Note:",
                noteText: "This digital process is for information and understanding. Your formal consent for the procedure will be recorded on the official physical consent form, which you will sign in the presence of your doctor and a witness.",
                fillAllFieldsAlert: "Please fill in all details and tick the consent checkbox to proceed.",
                reviewButtonAlert: "Please review the information carefully to ensure full understanding."
            },
            hi: {
                pageTitle: "विस्तृत किडनी बायोप्सी सहमति - कमांड अस्पताल (एससी) पुणे",
                selectLanguageLabel: "भाषा चुनें:",
                departmentName: "गुर्दा रोग विभाग",
                hospitalName: "कमांड अस्पताल (एससी) पुणे",
                consentProcessTitle: "अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी सहमति प्रक्रिया",
                disclaimerP1: "इस वीडियो-सहायता प्राप्त किडनी बायोप्सी सहमति पृष्ठ पर आपका स्वागत है। कमांड अस्पताल (एससी) पुणे के नेफ्रोलॉजी विभाग द्वारा प्रदान किया गया यह इंटरैक्टिव टूल, अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी प्रक्रिया के बारे में व्यापक दृश्य और पाठ्य जानकारी प्रदान करता है। इसका उद्देश्य आपकी औपचारिक सहमति देने से पहले प्रक्रिया को पूरी तरह से समझने में आपकी सहायता करना है।",
                disclaimerP2: "यह उपकरण केवल सूचना के उद्देश्यों के लिए है और आपके स्वास्थ्य सेवा प्रदाता के साथ सीधे, व्यक्तिगत परामर्श का स्थान नहीं लेता है। बायोप्सी से पहले आपके पास अपने डॉक्टर से किसी भी प्रश्न या चिंता पर चर्चा करने का एक समर्पित अवसर होगा। अपनी स्थिति के लिए विशिष्ट निदान, उपचार और चिकित्सा सलाह के लिए हमेशा एक योग्य चिकित्सा पेशेवर से परामर्श करें। प्रक्रिया से पहले आधिकारिक सहमति फॉर्म पर आपके भौतिक हस्ताक्षर की आवश्यकता होगी।",
                startButton: "सहमति प्रक्रिया शुरू करें",
                video1TextSectionTitle: "भाग 1: किडनी बायोप्सी का परिचय",
                video1TextSectionP1: "यह परिचयात्मक खंड आपको किडनी बायोप्सी के मूलभूत पहलुओं की स्पष्ट समझ प्रदान करने के लिए डिज़ाइन किया गया है।",
                video1TextSectionP2: "इस भाग को पढ़ने से, आप यह समझने के लिए आवश्यक प्रमुख बातों को जानेंगे कि प्रक्रिया में क्या शामिल है, इसकी अनुशंसा क्यों की जाती है, और आपको तैयारी के लिए क्या करना है।",
                video1TextSectionP3: "<ul><li><strong>किडनी बायोप्सी क्या है?</strong> एक चिकित्सा प्रक्रिया जिसमें किडनी ऊतक का एक छोटा सा नमूना माइक्रोस्कोप के तहत जांच के लिए निकाला जाता है, जो किडनी की बीमारियों का निदान करने, क्षति का आकलन करने या उपचार की प्रभावशीलता की निगरानी के लिए किया जाता है।</li><li><strong>यह क्यों आवश्यक है?</strong> यह प्रक्रिया इलाज करने वाले डॉक्टरों को एक सटीक निदान पर पहुंचने में मदद करने की संभावना है, जो आपकी बीमारी के लिए भविष्य की दिशा और इष्टतम उपचार की योजना बनाने और निर्णय लेने में भी मदद कर सकता है।</li><li><strong>किडनी बायोप्सी के लिए आपकी तैयारी:</strong> बायोप्सी से गुजरने से पहले आपको जिन महत्वपूर्ण कदमों और निर्देशों का पालन करना है।</li><li><strong>इस प्रक्रिया को न कराने के जोखिम:</strong> प्रक्रिया से न गुजरने से एक सटीक निदान में देरी हो सकती है या रोका जा सकता है, जिससे आपकी उपचार योजना और पूर्वानुमान पर संभावित रूप से असर पड़ सकता है।</li></ul>",
                questionText1Q: "क्या आप अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी की मूल परिभाषा, आवश्यकता और तैयारी के चरणों को समझते हैं?",
                proceedButton: "आगे बढ़ें",
                reviewButton: "इस अनुभाग की समीक्षा करें",
                video1Title: "वीडियो 1: किडनी बायोप्सी का परिचय",
                video1Intro: "यह वीडियो विस्तार से बताएगा कि किडनी बायोप्सी क्या है, यह क्यों आवश्यक है, और तैयारी के आवश्यक कदम।",
                watchVideoMessage: "आगे बढ़ने के लिए कृपया वीडियो देखें। वीडियो समाप्त होने पर प्रश्न नीचे दिखाई देगा।",
                transcriptTitle: "वीडियो ट्रांसक्रिप्ट:",
                questionVideo1Q: "क्या आपने इस वीडियो में दी गई जानकारी को समझ लिया है? यदि हाँ, तो अगले भाग पर जाएँ। यदि नहीं, तो वीडियो को फिर से देखें।",
                watchAgainButton: "वीडियो फिर से देखें",
                video2TextSectionTitle: "भाग 2: किडनी बायोप्सी प्रक्रिया का विवरण",
                video2TextSectionP1: "यह खंड आपको अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी प्रक्रिया के जटिल विवरणों के माध्यम से मार्गदर्शन करेगा।",
                video2TextSectionP2: "यह बायोप्सी के दौरान उठाए जाने वाले सटीक कदमों और प्रक्रिया पूरी होने के तुरंत बाद आप किस तत्काल देखभाल और निगरानी की उम्मीद कर सकते हैं, इसे कवर करता है।",
                video2TextSectionP3: "<ul><li><strong>सटीक किडनी बायोप्सी प्रक्रिया:</strong> बायोप्सी सुई की सटीक स्थापना सुनिश्चित करने के लिए रीयल-टाइम अल्ट्रासाउंड इमेजिंग का उपयोग करके बायोप्सी कैसे की जाती है, इसका एक दृश्य, चरण-दर-चरण स्पष्टीकरण। प्रक्रिया के दौरान, आप आमतौर पर अपने पेट के बल लेटेंगे। आपकी किडनी के ऊपर के विशिष्ट क्षेत्र को स्थानीय एनेस्थेटिक का उपयोग करके सुन्न किया जाएगा। डॉक्टर आपकी किडनी की कल्पना करने और एक या एक से अधिक छोटे ऊतक नमूने लेने के लिए एक पतली बायोप्सी सुई का सटीक मार्गदर्शन करने के लिए अल्ट्रासाउंड का उपयोग करेंगे। सुई डालने के दौरान किडनी की गति को कम करने के लिए आपको कुछ सेकंड के लिए अपनी सांस रोकने के लिए कहा जा सकता है।</li><li><strong>सेडेशन/एनेस्थीसिया तकनीक:</strong> प्रक्रिया स्थानीय एनेस्थीसिया के तहत की जाएगी, जो बायोप्सी स्थल को सुन्न कर देती है। इसके अतिरिक्त, यदि आवश्यक समझा जाए तो प्रक्रिया के दौरान आपको आराम करने में मदद करने के लिए सेडेशन भी दिया जा सकता है।</li><li><strong>बायोप्सी के तुरंत बाद की निगरानी:</strong> बायोप्सी के तुरंत बाद क्या होता है, जिसमें अवलोकन और प्रारंभिक देखभाल शामिल है।</li></ul>",
                questionText2Q: "क्या आप किडनी बायोप्सी की सटीक प्रक्रिया और बायोप्सी के तुरंत बाद के निगरानी कदमों के बारे में स्पष्ट हैं?",
                video2Title: "वीडियो 2: किडनी बायोप्सी प्रक्रिया",
                video2Intro: "यह वीडियो सटीक किडनी बायोप्सी प्रक्रिया और उसके तुरंत बाद क्या होता है, इसका प्रदर्शन करेगा।",
                questionVideo2Q: "क्या आपने प्रक्रिया का विवरण समझ लिया है? यदि हाँ, तो अगले भाग पर जाएँ। यदि नहीं, तो वीडियो को फिर से देखें।",
                video3TextSectionTitle: "भाग 3: बायोप्सी के बाद के निर्देश और जोखिम",
                video3TextSectionP1: "यह महत्वपूर्ण खंड किडनी बायोप्सी के बाद आपकी देखभाल के बारे में व्यापक जानकारी प्रदान करता है, जिसमें महत्वपूर्ण निर्देश और संभावित जोखिम शामिल हैं।",
                video3TextSectionP2: "इसका उद्देश्य यह सुनिश्चित करना है कि आप अपनी रिकवरी का प्रबंधन कैसे करें और किन बातों का ध्यान रखें, इस बारे में पूरी तरह से सूचित हों।",
                video3TextSectionP3: "<ul><li><strong>बायोप्सी के बाद के निर्देश:</strong> आपकी रिकवरी अवधि के लिए विस्तृत दिशानिर्देश, जिसमें गतिविधि प्रतिबंध और दवा सलाह शामिल है। प्रक्रिया के बाद, अवलोकन और आगे के प्रबंधन के लिए आपको गहन चिकित्सा इकाई (ICU) में हिरासत में रखने की आवश्यकता हो सकती है।</li><li><strong>चेतावनी के संकेत:</strong> महत्वपूर्ण लक्षण या परिवर्तन जिन पर तत्काल चिकित्सा ध्यान देने की आवश्यकता है।</li><li><strong>किडनी बायोप्सी से गुजरने के जोखिम:</strong> इस प्रक्रिया के साथ जोखिम और जटिलताएँ हैं। जबकि इन जटिलताओं को रोकने के लिए अत्यधिक सावधानी बरती जाएगी, उनमें निम्नलिखित शामिल हैं, लेकिन इन्हीं तक सीमित नहीं हैं:<ul><li>प्रक्रिया के दौरान और कुछ दिनों बाद तक कुछ दर्द और बेचैनी हो सकती है।</li><li>जटिलताओं का सामना करने की लगभग 10-15% संभावना है।</li><li>धमनी पंक्चर।</li><li>पेशाब में खून आना या किडनी के आसपास खून का जमा होना हो सकता है। यह प्रक्रिया के कुछ दिनों के भीतर अनायास बंद होने की संभावना है, लेकिन लगभग 0.5% संभावना है कि यह लंबे समय तक बना रह सकता है और इसके लिए रक्त आधान, कैथेटर एम्बोलिज़ेशन/कोइलिंग या सर्जरी की आवश्यकता हो सकती है। यदि आप वारफेरिन, एस्पिरिन या क्लोपिडोग्रेल जैसी खून पतला करने वाली दवाएं ले रहे हैं तो रक्तस्राव अधिक आम है।</li><li><strong>देर से होने वाली जटिलताएँ:</strong><ul><li>संक्रमण हो सकता है जिसके लिए एंटीबायोटिक और आगे के उपचार की आवश्यकता होती है।</li><li>आर्टेरियोवेनस फिस्टुला (एक धमनी और एक नस के बीच असामान्य संबंध) का बनना।</li><li>पैरालिटिक इलियस (आंत्र की गति का अस्थायी रूप से बंद होना)।</li><li>पेट और/या छाती में आंतरिक अंगों को चोट।</li><li>इस प्रक्रिया के कारण मृत्यु का न्यूनतम जोखिम भी है।</li></ul></li></ul></li></ul>",
                questionText3Q: "क्या आप बायोप्सी के बाद के निर्देशों, चेतावनी संकेतों और किडनी बायोप्सी से जुड़े संभावित जोखिमों को समझते हैं?",
                video3Title: "वीडियो 3: बायोप्सी के बाद के निर्देश और जोखिम",
                video3Intro: "यह वीडियो बायोप्सी के बाद के निर्देशों, चेतावनी संकेतों और किडनी बायोप्सी से गुजरने के जोखिमों के बारे में बताएगा।",
                questionVideo3Q: "क्या आपने बायोप्सी के बाद की देखभाल और जोखिमों को समझ लिया है? यदि हाँ, तो अंतिम सहमति के लिए आगे बढ़ें। यदि नहीं, तो वीडियो को फिर से देखें।",
                finalConsentStatementTitle: "अंतिम सहमति वक्तव्य",
                finalConsentP1: "आपने अब कमांड अस्पताल (एससी) पुणे में अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी के लिए व्यापक वीडियो-सहायता प्राप्त सूचनात्मक प्रक्रिया पूरी कर ली है।",
                finalConsentP2: "आगे बढ़कर, आप यह स्वीकार करते हैं कि डॉक्टर ने समझाया है:",
                finalConsentItem1: "मेरी चिकित्सीय स्थिति और प्रस्तावित प्रक्रिया (वास्तविक समय के अल्ट्रासाउंड मार्गदर्शन के तहत बायोप्सी गन के माध्यम से मेरी किडनी से एक ऊतक लेना) के बारे में बताया है, जिसमें डॉक्टर को कुछ अप्रत्याशित मिलने पर अतिरिक्त उपचार भी शामिल है। मैं जोखिमों को समझता/समझती हूं, जिसमें वे जोखिम भी शामिल हैं जो मेरे लिए विशिष्ट हैं।",
                finalConsentItem2: "अन्य प्रासंगिक प्रक्रिया/उपचार विकल्प और उनके संबंधित जोखिम।",
                finalConsentItem3: "मेरा पूर्वानुमान और प्रक्रिया न कराने के जोखिम।",
                finalConsentItem4: "कि कोई गारंटी नहीं दी गई है कि प्रक्रिया मेरी स्थिति में सुधार करेगी, भले ही इसे उचित पेशेवर देखभाल के साथ किया गया हो।",
                finalConsentItem5: "प्रक्रिया में रक्त आधान शामिल हो सकता है।",
                finalConsentItem6: "प्रक्रिया के बाद मुझे अवलोकन और आगे के प्रबंधन के लिए आईसीयू में हिरासत में रखने की आवश्यकता हो सकती है।",
                finalConsentItem7: "ऊतक और रक्त निकाले जा सकते हैं और मेरी स्थिति के निदान या प्रबंधन के लिए उपयोग किए जा सकते हैं, अस्पताल द्वारा संवेदनशील रूप से संग्रहीत और निपटाए जा सकते हैं।",
                finalConsentItem8: "यदि प्रक्रिया के दौरान तत्काल जानलेवा घटनाएं होती हैं, तो अस्पताल के निर्धारित प्रोटोकॉल के आधार पर उचित पुनर्जीवन विधियां शुरू की जाएंगी।",
                finalConsentItem9: "सलाहकार के अलावा कोई अन्य डॉक्टर प्रक्रिया कर सकता है। मैं समझता/समझती हूं कि यह एक डॉक्टर हो सकता है जो आगे का प्रशिक्षण ले रहा हो।",
                finalConsentItem10: "मैं अपनी स्थिति, प्रस्तावित प्रक्रिया और उसके जोखिमों, और मेरे उपचार विकल्पों के बारे में डॉक्टर से प्रश्न पूछने और चिंताएं उठाने में सक्षम था/थी। मेरे प्रश्नों और चिंताओं पर मेरी समझ की भाषा में चर्चा की गई है और मेरी संतुष्टि के लिए उत्तर दिए गए हैं।",
                finalConsentItem11: "मैं समझता/समझती हूं कि मुझे किसी भी समय अपना विचार बदलने का अधिकार है, जिसमें इस फॉर्म पर हस्ताक्षर करने के बाद भी शामिल है, लेकिन अधिमानतः मेरे डॉक्टर के साथ चर्चा के बाद।",
                finalConsentItem12: "मैं समझता/समझती हूं कि मेरी प्रक्रिया के हिस्से के रूप में और उसके दौरान छवि(यां) या वीडियो फुटेज रिकॉर्ड किए जा सकते हैं और ये छवि(यां) या वीडियो फुटेज डॉक्टर को उचित उपचार प्रदान करने में सहायता करेंगे।",
                finalConsentItem13: "मैं समझता/समझती हूं कि प्रक्रिया से गुजरने के लाभ जोखिमों से अधिक हैं और उपरोक्त जटिलताओं को रोकने के लिए अत्यधिक सावधानी बरती जाएगी।",
                finalConsentItem14: "उपरोक्त बयानों के आधार पर, मैं प्रक्रिया कराने का अनुरोध करता/करती हूं।",
                yourDetailsHeading: "इलेक्ट्रॉनिक समर्थन के लिए आपका विवरण",
                nameLabel: "पूरा नाम:",
                ageLabel: "आयु:",
                hospitalIdLabel: "अस्पताल आईडी नंबर:",
                downloadTranscriptButton: "पूरी ट्रांसक्रिप्ट डाउनलोड करें",
                consentCheckboxText: "मैं उपरोक्त बयानों को स्वीकार करता/करती हूं और अल्ट्रासाउंड-निर्देशित किडनी बायोप्सी प्रक्रिया कराने के अपने अनुरोध की पुष्टि करता/करती हूं।",
                consentBiopsyButton: "मैं बायोप्सी के लिए सहमति देता/देती हूं",
                thankYouMessage: "सूचनात्मक प्रक्रिया पूरी करने के लिए धन्यवाद। कृपया अपने स्वास्थ्य सेवा प्रदाता को अपने निर्णय के बारे में सूचित करें। आपके हस्ताक्षर के लिए एक भौतिक सहमति फॉर्म प्रदान किया जाएगा।",
                noteStrong: "ध्यान दें:",
                noteText: "यह डिजिटल प्रक्रिया सूचना और समझ के लिए है। प्रक्रिया के लिए आपकी औपचारिक सहमति आधिकारिक भौतिक सहमति फॉर्म पर दर्ज की जाएगी, जिस पर आप अपने डॉक्टर और एक गवाह की उपस्थिति में हस्ताक्षर करेंगे।",
                fillAllFieldsAlert: "कृपया आगे बढ़ने के लिए सभी विवरण भरें और सहमति चेकबॉक्स पर टिक करें।",
                reviewButtonAlert: "पूरी तरह से समझने के लिए कृपया जानकारी की सावधानीपूर्वक समीक्षा करें।"
            }
        };

        // --- YOUTUBE VIDEO IDs ---
        const videoIds = {
            videoPlayer1: "c42_3CXhoSE",
            videoPlayer2: "XguK849GQuk",
            videoPlayer3: "bpA3PeIjQ2Q"
        };

        // --- VIDEO TRANSCRIPTS (FOR DOWNLOAD) ---
        const videoTranscripts = {
            videoPlayer1: "This is the placeholder transcript for Video 1 (Introduction to Kidney Biopsy). It explains what a kidney biopsy is, why it is performed, and what preparations are needed before the procedure. Please replace this placeholder text with the real, full transcript of your video.",
            videoPlayer2: "This is the placeholder transcript for Video 2 (Kidney Biopsy Procedure). It details the step-by-step process of the biopsy and what to expect during and immediately after the procedure. Please replace this text with the real, full transcript of your video.",
            videoPlayer3: "This is the placeholder transcript for Video 3 (Post Biopsy Instructions and Risks). It covers essential post-biopsy care, outlines warning signs, and explains potential risks associated with a kidney biopsy. Please replace this text with the real, full transcript of your video."
        };

        // --- SCRIPT LOGIC ---
        let players = {}; // Object to hold player instances {player1: playerObject, ...}
        let playerIntervals = {}; // Object to hold interval timers {player1: intervalId, ...}
        let currentLang = 'en';

        const playerMap = {
            'video1Section': { playerVar: 'player1', videoIdKey: 'videoPlayer1', containerId: 'videoPlayer1', wrapperId: 'videoWrapper1', questionId: 'questionVideo1', messageId: 'videoMessage1' },
            'video2Section': { playerVar: 'player2', videoIdKey: 'videoPlayer2', containerId: 'videoPlayer2', wrapperId: 'videoWrapper2', questionId: 'questionVideo2', messageId: 'videoMessage2' },
            'video3Section': { playerVar: 'player3', videoIdKey: 'videoPlayer3', containerId: 'videoPlayer3', wrapperId: 'videoWrapper3', questionId: 'questionVideo3', messageId: 'videoMessage3' }
        };

        // This function is called by the YouTube Iframe Player API when it's ready.
        function onYouTubeIframeAPIReady() { 
            console.log("[API] YouTube Iframe API is ready.");
            // Players will be created dynamically when their sections are shown.
        }

        // ★★★ REFINED: Function to handle video state changes and progress checking ★★★
        function onPlayerStateChange(event, sectionInfo) {
            const player = event.target;
            const playerVar = sectionInfo.playerVar;
            const videoWrapper = document.getElementById(sectionInfo.wrapperId);
            const questionElement = document.getElementById(sectionInfo.questionId);

            // Clear any existing interval for this player to prevent duplicates
            if (playerIntervals[playerVar]) {
                clearInterval(playerIntervals[playerVar]);
                playerIntervals[playerVar] = null;
            }

            if (event.data === YT.PlayerState.PLAYING) {
                console.log(`[PLAYER] Video ${playerVar} started playing.`);
                questionElement.classList.add('hidden'); // Ensure question is hidden during playback
                videoWrapper.classList.remove('hide-yt-ui'); // Show player UI

                // Set up an interval to check the video's time
                playerIntervals[playerVar] = setInterval(() => {
                    const currentTime = player.getCurrentTime();
                    const duration = player.getDuration();
                    const pauseBeforeEnd = 3; // Pause 3 seconds before actual end

                    // When video is near the end, pause it and show the prompt
                    if (duration > 0 && currentTime >= duration - pauseBeforeEnd) {
                        player.pauseVideo();
                        clearInterval(playerIntervals[playerVar]); // Important: stop the interval
                        playerIntervals[playerVar] = null;
                        
                        questionElement.classList.remove('hidden'); // Show the prompt
                        videoWrapper.classList.add('hide-yt-ui'); // Hide the YouTube UI
                        console.log(`[PLAYER] Video ${playerVar} paused near end. Question shown.`);
                    }
                }, 500); // Check every half second

            } else if (event.data === YT.PlayerState.ENDED) {
                console.log(`[PLAYER] Video ${playerVar} ended.`);
                // Fallback: If the interval doesn't catch it, show prompt on natural end
                clearInterval(playerIntervals[playerVar]);
                questionElement.classList.remove('hidden');
                videoWrapper.classList.add('hide-yt-ui');

            } else if (event.data === YT.PlayerState.PAUSED) {
                // If user pauses manually, just clear the interval.
                // The prompt will only show if paused by our "pauseBeforeEnd" logic.
                console.log(`[PLAYER] Video ${playerVar} paused.`);
                clearInterval(playerIntervals[playerVar]);
            }
        }
        
        // Function to create and load a YouTube player
        function createAndLoadPlayer(containerDivId, videoId, playerIdVarName, sectionInfo) {
            console.log(`[API] Creating player for div ID: ${containerDivId}, YouTube Video ID: ${videoId}`);
            
            if (players[playerIdVarName]) {
                players[playerIdVarName].destroy();
            }

            players[playerIdVarName] = new YT.Player(containerDivId, {
                videoId: videoId,
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 0,
                    'modestbranding': 1,
                    'fs': 0,
                    'iv_load_policy': 3,
                    'origin': window.location.origin // Crucial for security and preventing errors
                },
                events: {
                    'onReady': (event) => {
                        console.log(`[API] Player ${playerIdVarName} ready.`);
                        const messageElement = document.getElementById(sectionInfo.messageId);
                        if (messageElement) {
                            messageElement.classList.remove('hidden');
                            messageElement.textContent = localizedContent[currentLang].watchVideoMessage;
                        }
                        const videoWrapper = document.getElementById(sectionInfo.wrapperId);
                        if (videoWrapper) videoWrapper.classList.remove('hide-yt-ui');
                    },
                    'onStateChange': (event) => onPlayerStateChange(event, sectionInfo),
                    'onError': (event) => console.error(`[API ERROR] Player ${playerIdVarName} error:`, event.data)
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            
            function updateContent(lang) {
                currentLang = lang;
                const content = localizedContent[lang];
                document.documentElement.lang = lang; 

                const safeUpdateText = (elementId, textContentKey) => {
                    const element = document.getElementById(elementId);
                    if (element && content[textContentKey] !== undefined) {
                        element.textContent = content[textContentKey];
                    }
                };

                const safeUpdateHTML = (elementId, htmlContentKey) => {
                    const element = document.getElementById(elementId);
                    if (element && content[htmlContentKey] !== undefined) {
                        element.innerHTML = content[htmlContentKey];
                    }
                };
                
                document.title = content.pageTitle || "Consent Form";

                safeUpdateText('selectLanguageLabel', 'selectLanguageLabel');
                safeUpdateText('departmentName', 'departmentName');
                safeUpdateText('hospitalName', 'hospitalName');
                safeUpdateText('consentProcessTitle', 'consentProcessTitle');
                safeUpdateText('disclaimerP1', 'disclaimerP1');
                safeUpdateText('disclaimerP2', 'disclaimerP2');
                safeUpdateText('startProcessButton', 'startButton');
                safeUpdateText('video1TextSectionTitle', 'video1TextSectionTitle');
                safeUpdateText('video1TextSectionP1', 'video1TextSectionP1');
                safeUpdateText('video1TextSectionP2', 'video1TextSectionP2');
                safeUpdateHTML('video1TextSectionP3', 'video1TextSectionP3');
                safeUpdateText('questionText1Q', 'questionText1Q');
                safeUpdateText('btn1Proceed', 'proceedButton');
                safeUpdateText('btn1Review', 'reviewButton');
                safeUpdateText('video1Title', 'video1Title');
                safeUpdateText('video1Intro', 'video1Intro');
                safeUpdateText('videoMessage1', 'watchVideoMessage');
                safeUpdateText('questionVideo1Q', 'questionVideo1Q');
                safeUpdateText('btn1VideoProceed', 'proceedButton');
                safeUpdateText('btn1WatchAgain', 'watchAgainButton');
                safeUpdateText('video2TextSectionTitle', 'video2TextSectionTitle');
                safeUpdateText('video2TextSectionP1', 'video2TextSectionP1');
                safeUpdateText('video2TextSectionP2', 'video2TextSectionP2');
                safeUpdateHTML('video2TextSectionP3', 'video2TextSectionP3');
                safeUpdateText('questionText2Q', 'questionText2Q');
                safeUpdateText('btn2Proceed', 'proceedButton');
                safeUpdateText('btn2Review', 'reviewButton');
                safeUpdateText('video2Title', 'video2Title');
                safeUpdateText('video2Intro', 'video2Intro');
                safeUpdateText('videoMessage2', 'watchVideoMessage');
                safeUpdateText('questionVideo2Q', 'questionVideo2Q');
                safeUpdateText('btn2VideoProceed', 'proceedButton');
                safeUpdateText('btn2WatchAgain', 'watchAgainButton');
                safeUpdateText('video3TextSectionTitle', 'video3TextSectionTitle');
                safeUpdateText('video3TextSectionP1', 'video3TextSectionP1');
                safeUpdateText('video3TextSectionP2', 'video3TextSectionP2');
                safeUpdateHTML('video3TextSectionP3', 'video3TextSectionP3');
                safeUpdateText('questionText3Q', 'questionText3Q');
                safeUpdateText('btn3Proceed', 'proceedButton');
                safeUpdateText('btn3Review', 'reviewButton');
                safeUpdateText('video3Title', 'video3Title');
                safeUpdateText('video3Intro', 'video3Intro');
                safeUpdateText('videoMessage3', 'watchVideoMessage');
                safeUpdateText('questionVideo3Q', 'questionVideo3Q');
                safeUpdateText('btn3VideoProceed', 'proceedButton');
                safeUpdateText('btn3WatchAgain', 'watchAgainButton');
                safeUpdateText('finalConsentStatementTitle', 'finalConsentStatementTitle');
                safeUpdateText('finalConsentP1', 'finalConsentP1');
                safeUpdateText('finalConsentP2', 'finalConsentP2');
                safeUpdateText('finalConsentItem1', 'finalConsentItem1');
                safeUpdateText('finalConsentItem2', 'finalConsentItem2');
                safeUpdateText('finalConsentItem3', 'finalConsentItem3');
                safeUpdateText('finalConsentItem4', 'finalConsentItem4');
                safeUpdateText('finalConsentItem5', 'finalConsentItem5');
                safeUpdateText('finalConsentItem6', 'finalConsentItem6');
                safeUpdateText('finalConsentItem7', 'finalConsentItem7');
                safeUpdateText('finalConsentItem8', 'finalConsentItem8');
                safeUpdateText('finalConsentItem9', 'finalConsentItem9');
                safeUpdateText('finalConsentItem10', 'finalConsentItem10');
                safeUpdateText('finalConsentItem11', 'finalConsentItem11');
                safeUpdateText('finalConsentItem12', 'finalConsentItem12');
                safeUpdateText('finalConsentItem13', 'finalConsentItem13');
                safeUpdateText('finalConsentItem14', 'finalConsentItem14');
                safeUpdateText('yourDetailsHeading', 'yourDetailsHeading');
                safeUpdateText('nameLabel', 'nameLabel'); 
                safeUpdateText('ageLabel', 'ageLabel'); 
                safeUpdateText('hospitalIdLabel', 'hospitalIdLabel'); 
                safeUpdateText('downloadTranscriptBtn', 'downloadTranscriptButton');
                safeUpdateText('consentCheckboxText', 'consentCheckboxText');
                safeUpdateText('submitConsentButton', 'consentBiopsyButton');
                safeUpdateText('thankYouMessage', 'thankYouMessage');
                safeUpdateText('noteStrong', 'noteStrong');
                safeUpdateText('noteText', 'noteText');
            }

            function showSection(sectionId) {
                document.querySelectorAll('.container > .section-box').forEach(section => {
                    section.classList.add('hidden');
                });
                const sectionToShow = document.getElementById(sectionId);
                if (sectionToShow) {
                    sectionToShow.classList.remove('hidden');
                    window.scrollTo({ top: sectionToShow.offsetTop - 20, behavior: 'smooth' });
                } else {
                    console.error(`[ERROR] Section with ID ${sectionId} not found.`);
                    return;
                }

                if (sectionId.startsWith('video') && sectionId !== 'finalConsentSection') {
                    const info = playerMap[sectionId];
                    if (info) {
                        createAndLoadPlayer(info.containerId, videoIds[info.videoIdKey], info.playerVar, info); 
                    }
                }
            }

            document.getElementById('startProcessButton').addEventListener('click', () => {
                showSection('textSection1');
            });

            document.querySelectorAll('.yes-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const nextSectionId = event.target.dataset.target;
                    showSection(nextSectionId);
                });
            });
            
            document.querySelectorAll('.no-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const action = event.target.dataset.action;
                    alert(localizedContent[currentLang].reviewButtonAlert); 

                    if (action === 'rewatch-text') {
                        const targetSectionId = event.target.dataset.target;
                        const targetEl = document.getElementById(targetSectionId);
                        if(targetEl) {
                            window.scrollTo({ top: targetEl.offsetTop - 20, behavior: 'smooth' });
                        }
                    } else if (action === 'rewatch-video') {
                        const playerIdVarName = event.target.dataset.playerId; 
                        const sectionInfo = Object.values(playerMap).find(info => info.playerVar === playerIdVarName);
                        
                        if (sectionInfo && players[playerIdVarName]) {
                            const player = players[playerIdVarName];
                            const videoWrapper = document.getElementById(sectionInfo.wrapperId);
                            const questionElement = document.getElementById(sectionInfo.questionId);

                            questionElement.classList.add('hidden');
                            videoWrapper.classList.remove('hide-yt-ui'); 

                            player.seekTo(0, true); 
                            player.playVideo(); 
                            console.log(`[PLAYER] Rewatching video ${playerIdVarName}.`);
                        }
                    }
                });
            });
            
            document.getElementById('downloadTranscriptBtn').addEventListener('click', () => {
                let fullTranscript = `${localizedContent[currentLang].pageTitle}\n\n`;
                fullTranscript += `--- ${localizedContent[currentLang].video1Title} ---\n`;
                fullTranscript += videoTranscripts.videoPlayer1 + "\n\n";
                fullTranscript += `--- ${localizedContent[currentLang].video2Title} ---\n`;
                fullTranscript += videoTranscripts.videoPlayer2 + "\n\n";
                fullTranscript += `--- ${localizedContent[currentLang].video3Title} ---\n`;
                fullTranscript += videoTranscripts.videoPlayer3 + "\n\n"; 

                const blob = new Blob([fullTranscript], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Consent_Transcripts_${currentLang.toUpperCase()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            const patientNameInput = document.getElementById('patientName');
            const patientAgeInput = document.getElementById('patientAge');
            const hospitalIdInput = document.getElementById('hospitalId');
            const consentCheckbox = document.getElementById('consentCheckbox');
            const submitConsentButton = document.getElementById('submitConsentButton');
            
            function checkFinalConsentConditions() {
                const isNameFilled = patientNameInput.value.trim() !== '';
                const isAgeFilled = patientAgeInput.value.trim() !== '';
                const isHospitalIdFilled = hospitalIdInput.value.trim() !== '';
                const isCheckboxChecked = consentCheckbox.checked;
                submitConsentButton.disabled = !(isNameFilled && isAgeFilled && isHospitalIdFilled && isCheckboxChecked);
            }

            [patientNameInput, patientAgeInput, hospitalIdInput, consentCheckbox].forEach(el => {
                el.addEventListener('input', checkFinalConsentConditions);
                el.addEventListener('change', checkFinalConsentConditions);
            });

            submitConsentButton.addEventListener('click', () => {
                if (submitConsentButton.disabled) {
                    alert(localizedContent[currentLang].fillAllFieldsAlert);
                    return;
                }
                const consentData = {
                    procedure: localizedContent[currentLang].consentProcessTitle,
                    consentGiven: true,
                    timestamp: new Date().toISOString(),
                    patientName: patientNameInput.value.trim(),
                    patientAge: patientAgeInput.value.trim(),
                    hospitalId: hospitalIdInput.value.trim(),
                    language: currentLang,
                };
                console.log("Consent Recorded (Client-side Demo):", consentData);
                
                document.querySelectorAll('#yourDetailsHeading, #nameLabel, #patientName, #ageLabel, #patientAge, #hospitalIdLabel, #hospitalId, #downloadTranscriptBtn, #consentCheckboxLabel, #submitConsentButton').forEach(el => el.classList.add('hidden'));
                document.getElementById('thankYouMessage').classList.remove('hidden');
            });
            
            document.getElementById('languageSelect').addEventListener('change', (e) => updateContent(e.target.value));
            
            updateContent('en');
            document.getElementById('introSection').classList.remove('hidden');
        });
    </script>
</body>
</html>
